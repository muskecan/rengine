{% load static %}
{% load permission_tags %}

<div class="navbar-custom">
  <div class="container-fluid">
    <ul class="list-unstyled topnav-menu float-end mb-0">
      <!-- Mobile Search Toggle -->
      <li class="d-lg-none">
        <a class="nav-link waves-effect waves-light" href="#" data-bs-toggle="collapse" data-bs-target="#mobile-search-box" aria-expanded="false">
          <i class="fe-search noti-icon"></i>
        </a>
      </li>
      <!-- Desktop Search -->
      <li class="d-none d-lg-block">
      <form class="app-search" method="get" action="/{{current_project.slug}}/search">
        <div class="app-search-box dropdown">
          <div class="input-group">
            <input type="search" class="form-control" placeholder="Universal Search..." id="top-search" name="query">
            <button class="btn input-group-text" type="submit">
              <i class="fe-search"></i>
            </button>
          </div>
          <div class="dropdown-menu dropdown-lg" id="search-dropdown">
            <div class="dropdown-header noti-title">
              <h5 class="text-overflow mb-2">Search History</h5>
            </div>
            <div id="search-history-items">
            </div>
          </div>
        </div>
      </form>
      </li>
      <!-- Projects Dropdown - visible on tablet and larger, mobile gets it in nav -->
      <li class="dropdown d-none d-lg-block">
        <a class="nav-link dropdown-toggle waves-effect waves-light" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
            Projects
            <i class="mdi mdi-chevron-down ms-1"></i>
        </a>
        <div class="dropdown-menu">
          {% for project in projects %}
            <a href="/{{project.slug}}/dashboard" class="dropdown-item {% if project == current_project %} active {% endif %}">
              <span>{{project.name}}</span>
            </a>
          {% endfor %}
          <div class="dropdown-divider"></div>
           {% if request.user|can:'modify_targets' %}
            <a href="#" onclick="add_project_modal()" class="dropdown-item"><i class="mdi mdi-account-plus"></i> Create New Project</a>
          {% endif %}
        </div>
      </li>
      {% if user|can:'modify_targets' or user|can:'modify_scan_configurations' or user|can:'modify_system_configurations' or user|can:'modify_wordlists' %}
      <!-- Quick Add Dropdown - visible on tablet and larger -->
      <li class="dropdown d-none d-lg-block">
        <a class="nav-link dropdown-toggle waves-effect waves-light" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
          <i class="fe-plus me-1"></i> <span class="d-none d-xl-inline">Quick Add</span>
          <i class="mdi mdi-chevron-down d-none d-xl-inline"></i>
        </a>
        <div class="dropdown-menu">
          {% if user|can:'modify_targets' %}
          <a href="#" onclick="show_quick_add_target_modal()" class="dropdown-item">
            <i class="fe-crosshair me-1"></i>
            <span>Target</span>
          </a>
          <a href="{% url 'add_organization' current_project.slug %}" class="dropdown-item">
            <i class="fe-briefcase me-1"></i>
            <span>Organization</span>
          </a>
          {% endif %}
          {% if user|can:'modify_scan_configurations' %}
          <a href="{% url 'add_engine' current_project.slug %}" class="dropdown-item">
            <i class="fe-cpu me-1"></i>
            <span>Scan Engine</span>
          </a>
          {% endif %}
          {% if user|can:'modify_system_configurations' %}
          <a href="{% url 'add_tool' current_project.slug %}" class="dropdown-item">
            <i class="mdi mdi-hammer-wrench me-1"></i>
            <span>External Tool</span>
          </a>
          {% endif %}
          {% if user|can:'modify_wordlists' %}
          <a href="{% url 'add_wordlist' current_project.slug %}" class="dropdown-item">
            <i class="fe-list me-1"></i>
            <span>Wordlist</span>
          </a>
          {% endif %}
        </div>
      </li>
      {% endif %}
      <!-- Toolbox - visible on tablet and larger -->
      <li class="dropdown d-none d-md-inline-block topbar-dropdown">
        <a class="nav-link dropdown-toggle arrow-none waves-effect waves-light" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
          <i class="fe-grid noti-icon"></i>
        </a>
        <div class="dropdown-menu dropdown-lg dropdown-menu-end">
          <div class="p-lg-1">
            <h5>Toolbox</h5>
            <div class="row g-0">
              <div class="col" onclick="show_whois_lookup_modal()">
                <a class="dropdown-icon-item" href="#">
                  <img src="/staticfiles/img/global.png" alt="whois">
                  <span>Whois</span>
                </a>
              </div>
              <div class="col" onclick="cms_detector()">
                <a class="dropdown-icon-item" href="#">
                  <img src="/staticfiles/img/magnifying.png" alt="cms_detector">
                  <span>CMS Detector</span>
                </a>
              </div>
              <div class="col" onclick="toolbox_cve_detail()">
                <a class="dropdown-icon-item" href="#">
                  <img src="/staticfiles/img/ladybug.png" alt="cve_lookup">
                  <span>CVE Lookup</span>
                </a>
              </div>
              <div class="col" onclick="toolbox_waf_detector()">
                <a class="dropdown-icon-item" href="#">
                  <img src="/staticfiles/img/firewall.png" alt="waf_detector">
                  <span>WAF Detector</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </li>
      <li class="dropdown d-none d-lg-inline-block">
        <a class="nav-link dropdown-toggle waves-effect waves-light" href="#">
          <div class="">
            <i class="fe-sun"></i>
            &nbsp;
            <label class="switch s-outline s-outline-primary">
              <input type="checkbox" class="theme-shifter" onclick="changeTheme()" id="dark-mode-check">
              <span class="slider round toggle-theme-switch">
              </span>
            </label>
            &nbsp;
            <i class="fe-moon"></i>
          </div>
        </a>
      </li>
      <li class="dropdown notification-list">
        <a class="nav-link dropdown-toggle waves-effect waves-light arrow-none notification-a-icon" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
          <div class="notification-bell-icon">
            <i class="fe-bell font-22"></i>
          </div>
          <span class="badge bg-danger rounded-circle noti-icon-badge badge-notif-count notif-counter" id="notification-counter"></span>
        </a>
        <div class="dropdown-menu dropdown-menu-end notification-panel-dropdown">
          <div class="notification-panel-header d-flex justify-content-between align-items-center p-3">
            <h6 class="m-0">Notifications</h6>
            <div>
              <a href="javascript: void(0);" class="notification-panel-mark-read-link me-3" id="mark-all-read-btn">Mark all as read</a>
              <a href="javascript: void(0);" class="notification-panel-clear-link" id="clear-notif-btn">Clear All</a>
            </div>
          </div>
          <div class="px-1" style="max-height: 400px;" data-simplebar>
            <div class="notification-panel-body">
              <!-- populate the notifications here -->
            </div>
          </div>
        </div>
      </li>
      <li class="dropdown top-activity-counter">
        <a class="nav-link dropdown-toggle waves-effect waves-light" href="#" onclick="getScanStatusSidebar('{{current_project.slug}}', false); showRightSidebar(); return false;">
          <i class="fe-activity noti-icon"></i>
          <span class="badge bg-danger noti-icon-badge badge-notif-count" id="current_scan_counter"></span>
        </a>
      </li>
      <li class="dropdown notification-list topbar-dropdown">
        <a class="nav-link dropdown-toggle nav-user me-0 waves-effect waves-light" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
          <i class="fe-user noti-icon d-inline d-md-none"></i>
          <span class="pro-user-name d-none d-md-inline">
            {{user.get_username}}<i class="mdi mdi-chevron-down"></i>
          </span>
        </a>
        <div class="dropdown-menu dropdown-menu-end profile-dropdown ">
          <div class="dropdown-header noti-title">
            <h6 class="text-overflow m-0">Welcome {{user.get_username}}!</h6>
          </div>
          <a href="{% url 'profile' current_project.slug %}" class="dropdown-item notify-item">
            <i class="fe-user"></i>
            <span>My Account</span>
          </a>
          <div class="dropdown-divider"></div>
          <a href="javascript:toggleBugBountyMode()" class="dropdown-item notify-item">
            <i class="fe-target"></i>
            <span>
              {% if user_preferences.bug_bounty_mode %}
                Disable Bug Bounty Mode
              {% else %}
                Enable Bug Bounty Mode
              {% endif %}
            </span>
          </a>
          {% if user|can:'modify_system_configurations' %}
          <a href="{% url 'admin_interface' current_project.slug %}" class="dropdown-item notify-item">
            <i class="fe-settings"></i>
            <span>Admin Settings</span>
          </a>
          <div class="dropdown-divider"></div>
          <a href="javascript: check_rengine_update()" class="dropdown-item notify-item">
            <i class="fe-refresh-cw"></i>
            <span>Check reNgine Update <small class="text-danger rengine_update_available"></br>Update available!</small></span>
          </a>
          {% endif %}
          <div class="dropdown-divider"></div>
          <a href="{% url 'logout' %}" class="dropdown-item notify-item">
            <i class="fe-log-out"></i>
            <span>Logout</span>
          </a>
        </div>
      </li>
    </ul>
    <ul class="list-unstyled topnav-menu topnav-menu-left m-0">
      <li>
        <button class="button-menu-mobile waves-effect waves-light">
          <i class="fe-menu"></i>
        </button>
      </li>
      <li>
        <a class="navbar-toggle nav-link" data-bs-toggle="collapse" data-bs-target="#topnav-menu-content">
          <div class="lines">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </a>
      </li>
    </ul>
    <div class="logo-box d-none d-lg-block">
      <a href="{% url 'dashboardIndex' current_project.slug %}" class="logo logo-dark text-center">
        <span class="logo-sm">
          <h3 class="text-logo vertical-center">reNgine&nbsp;<small>{{RENGINE_CURRENT_VERSION}}</small></h3>
        </span>
        <span class="logo-lg">
          <h3 class="text-logo vertical-center">reNgine&nbsp;<small>{{RENGINE_CURRENT_VERSION}}</small></h3>
        </span>
      </a>
      <a href="{% url 'dashboardIndex' current_project.slug %}" class="logo logo-light text-center">
        <span class="logo-sm">
          <h3 class="text-sm-logo vertical-center">reNgine&nbsp;<small>{{RENGINE_CURRENT_VERSION}}</small></h3>
        </span>
        <span class="logo-lg">
          <h3 class="text-lg-logo vertical-center">reNgine&nbsp;<small>{{RENGINE_CURRENT_VERSION}}</small></h3>
        </span>
      </a>
    </div>
    <div class="clearfix"></div>
  </div>
  <!-- Mobile Search Box -->
  <div class="collapse d-lg-none" id="mobile-search-box">
    <div class="container-fluid py-2 px-3 bg-light">
      <form class="app-search" method="get" action="/{{current_project.slug}}/search">
        <div class="input-group">
          <input type="search" class="form-control" placeholder="Search targets, subdomains, vulns..." name="query">
          <button class="btn btn-primary" type="submit">
            <i class="fe-search"></i>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
